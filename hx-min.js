var HXGlobalJS=function(t,i){function e(t){k.length&&(m=new HXVideoLinks,0!==i.length&&(b=new HXPopUpProblems(r.PUPOptions,i)));var e=$("a.hx-vidtime");if(e.on("click tap",function(){var t=m.hmsToTime($(this).attr("data-time")),i=$(this).attr("href").replace("#video","");m.jumpToTime(i,t),l({"link starts video at time":t})}),t.makeTOC){$("#seq_content .xblock:first-of-type").prepend('<div id="autoTOC" class="hx-autotoc"></div>');var o="<h3>Table of Contents</h3><ul>",n=$("h3, h4").filter(function(){return $(this).is(":visible")});$("#autoTOC ul");n.each(function(t){$(this).attr("id","TOCLink"+t);var i,e=$(this).text();$(this).is("h3")&&(i=3,$(n[t-1]).is("h3")||0==t?o+='<li class="autotoc'+i+'"><a href="#TOCLink'+t+'">'+e+"</a></li>":$(n[t-1]).is("h4")&&(o+='</ul></li><li class="autotoc'+i+'"><a href="#TOCLink'+t+'">'+e+"</a></li>")),$(this).is("h4")&&(i=4,$(n[t-1]).is("h3")?(t>0&&o.slice(0,o.length-5),o+='<ul><li class="autotoc'+i+'"><a href="#TOCLink'+t+'">'+e+"</a></li>"):$(n[t-1]).is("h4")&&(o+='<li class="autotoc'+i+'"><a href="#TOCLink'+t+'">'+e+"</a></li>"))}),o+="</ul>",$("#autoTOC").append(o)}if(t.showUTCClock){var a='<li style="float:right;"><iframe src="https://freesecure.timeanddate.com/clock/i53t5o51/fc5e5e5e/tct/pct/ftb/ts1/ta1" title="UTC Clock" frameborder="0" width="100" height="16" style="padding-left: 11px; padding-top: 11px;"></iframe></div>',h=$(".course-tabs");h.append(a)}$("[class^=hx-togglebutton]").on("click tap",function(){var t=s(this.className,"hx-togglebutton");$(".hx-toggletarget"+t).slideToggle("fast"),l({"Toggle button":"pressed","Toggle number":t})}),$("[class^=hx-highlighter]").on("click tap",function(){var i=s(this.className,"hx-highlighter");t.highlightState?$(".hx-highlight"+i).animate({backgroundColor:t.highlightColor},200):$(".hx-highlight"+i).animate({backgroundColor:t.highlightBackground},200),t.highlightState=!t.highlightState,l({"Highlight button":"pressed","Highlight number":i})}),t.hxOpenDiscussion&&($(".discussion-show.control-button").click(),l({Discussion:"auto-opened"}));var c=$(".hx-popup-opener");c.length&&($("map").each(function(t){var i=[];$(this).find("area").each(function(t){i.push('<li class="'+this.className.split(/\s+/)[0]+' hx-popup-opener" title="'+this.title+'"><a href="javascript:;">'+this.title+"</a></li>")});var e="<ul>"+i.join("")+"</ul>";e="<h4>Clickable Areas:</h4>"+e,$(this).after(e)}),c=$(".hx-popup-opener"),c.on("click tap",function(){var t=this.className,i=t.split(/\s+/)[0];$("div."+i).dialog({dialogClass:"hx-popup-dialog",title:$(this).attr("title"),show:{effect:"fade",duration:200},hide:{effect:"fade",duration:100},buttons:{Close:function(){$(this).dialog("close")}}},function(t){$("div."+t).css({display:""}),alert(t)}),l({"Pop-up Dialog":"opened",Dialog:i})}));var d=$('span[class^="hx-footnote"]');if(d.length)for(var p,u,f,T,O,w=0;w<d.length;w++)p=d[w],u=s(p.className,"hx-footnote"),f=$("div.hx-footnote-target"+u),$(p).addClass("hx-footnote-style"),$(p).wrap("<sup></sup>"),T=$('h3:contains("Footnote")'),O=$(T[T.length-1]).parent(),$(f).detach().appendTo(O),$(p).wrap('<a href="#hxfoot'+u+'" name="hxfootback'+u+'"></a>').wrap(),f.prepend('<a name="hxfoot'+u+'"></a>'),f.append('<p><a href="#hxfootback'+u+'">(back)</a></p>');g.length&&(g.slick(t.slickOptions),l({slider:"created"})),v.length&&x.length&&(v.slick(t.slickNavOptions),x.slick(t.slickBigOptions),l({"paired slider":"created"}))}function o(t,i){var e=t.match(/https:\/\/.+.org\//)[0];if("site"==i)return e;var o=t.replace("courses/course","asset"),n=o.indexOf("/courseware/");return o=o.slice(0,n),o+="+type@asset+block/","partial"==i?o.replace(e,""):o}function n(t){var i=o(t,"partial"),e={};return i=i.split(":")[1],e.institution=i.split("+")[0],e.id=i.split("+")[1],e.run=i.split("+")[2],e}function s(t,i){for(var e=t.split(/\s+/),o=0;o<e.length;o++)if(0===e[o].indexOf(i))return e[o].slice(i.length);return-1}function a(t,i,e){var o={};return t||i?o=t?i?$.extend(!0,{},e,i,t):$.extend(!0,{},e,t):$.extend(!0,{},e,i):e}function l(t){console.log(JSON.stringify(t)),Logger.log(p+".hxjs",t)}var r={showUTCClock:!1,hxOpenDiscussion:!1,makeTOC:!1,highlightColor:"#ff0",highlightBackground:"rgba(0,0,0,0)",highlightState:!0,slickOptions:{arrows:!0,dots:!0,infinite:!0,slidesToShow:3,slidesToScroll:3},slickNavOptions:{asNavFor:".hx-bigslider",variableWidth:!0,focusOnSelect:!0,slidesToShow:3,slidesToScroll:1},slickBigOptions:{asNavFor:".hx-navslider",arrows:!1,dots:!0,fade:!0,adaptiveHeight:!0,slidesToShow:1,slidesToScroll:1},PUPOptions:{width:800,effect:"fade",effectlength:200,myPosition:"center",atPosition:"center",ofTarget:window}},h=o(window.location.href,"complete");l(h);var c=o(window.location.href,"site");if(c.indexOf("studio")>-1)return void console.log("Running HXJS in studio is probably not great.");var d=n(window.location.href),p=d.institution+"."+d.id+"_"+d.run;l({"HX.js":"enabled"}),l({"course log id":p});var u={};$.getScript(h+"hxGlobalOptions.js").done(function(){l({"Course options":"loaded"}),u=a(t,hxGlobalOptions,r)}).fail(function(){l({"Course options":"default"}),u=a(t,{},r)}),$.getMultiScripts=function(t,i){var e=$.map(t,function(t){return $.getScript((i||"")+t)});return e.push($.Deferred(function(t){$(t.resolve)})),$.when.apply($,e)};var f=[],g=$(".hx-slider"),v=$(".hx-navslider"),x=$(".hx-bigslider");(g.length||v.length&&x.length)&&(l({image_slider:"found"}),f.push("slick.js"));var k=$(".video");if(k.length){l({video:"found"}),f.push("HXVideoLinks.js");var m;if(0!==i.length){f.push("HXPopUpProblems.js");var b}}$.getMultiScripts(f,h).done(function(){l({"Loaded scripts":f}),e(u)}).fail(function(){l("Failed to load scripts")}),function(t){t.fn.hxKonami=function(i,e){return void 0===e&&(e="38,38,40,40,37,39,37,39,66,65"),this.each(function(){var o=[];t(this).keydown(function(t){for(o.push(t.keyCode);o.length>e.split(",").length;)o.shift();o.toString().indexOf(e)>=0&&(o=[],i(t))})})}}(jQuery),$(window).hxKonami(function(){alert("+30 Lives"),l({"easter egg":"Konami Code"})})};if("undefined"==typeof hxLocalOptions)var hxLocalOptions={};if("undefined"==typeof HXPUPTimer)var HXPUPTimer=[];$(document).ready(function(){HXGlobalJS(hxLocalOptions,HXPUPTimer)});